# 数据库系统设计与开发 课程笔记

数据库应用与设计(上应用/下设计) 

持久数据库 Oracle数据库 阿里版本(OceamDB,外用oracle内用mysql) 

缓存数据库 MogoDB redis (跑在内存中)

# 上篇

## 第一节课

### 课前导论

为什么要学习Oracle11G?
	信息系统建设需要 一般公司通常在他们的信息系统架构中引入多种数据库平台
	个人能力发展需求 公司青睐有多个领域经验的求职者

Oracle版本介绍 使用11.2.0.1.0

课程分类:
	应用部分: Oracle数据库的日常维护管理 (数据库安装(命令行) 安全性维护 备份还原)
	设计部分: Oracle数据库在应用系统中开发的作用 (Oracle特有函数库的使用 PL/SQL程序设计)
	应用部分的内容是数据库管理员必须掌握的,设计部分是应用系统开发工程师必须掌握的

测评方式:
	平时: 20%(到课情况) 实训: 40%(参加基本都能过) 期末: 40%

Oracle甲骨文公司介绍发展

网格计算概念和特点
	通常讲,网格讲网络上地理分布的各种资源聚合为一体,支持应用问题合作求解的构造
	特点: 公用设施一样 随时 按区分布 目标是使数据成为数据日用品

RAC应用集群
	高性能计算科学集群
	负载均衡集群
	高可用性(数据同步集群)
	特点: 并发控制和数据一致性 多个终端都可以使用
	......

DBA关键任务

### Oracle数据库管理系统体系结构

框架

1. Oracle数据库系统体系和结构总览
2. 物理结构
3. 逻辑结构
4. 关键级后台进程
5. SQL语句执行过程

总体概述:

Oracle分为实部分和虚部分(硬盘和内存)

公式:

1. Oracle数据库系统=实例+数据库 实例由内存和进程组成
2. 实例=内存结构+后台进程
3. 数据库在磁盘中以各种类型文件组成 (数据在磁盘里存在形式为文件)
4. 主要内存区域分为用户全局区,进程全局区和系统全局区

用户进程: 当用户请求连接到数据库时启动

服务进程: 连接到Oracle实例并当用户创建一个会话时启动

后台进程: 当Oracle实例启动时启动

系统全局区: 内存划分 一组共享的内存结构 里面存储了Oracle数据库实例的数据和控制文件信息

进程全局区:

用户在他们的计算机上启动基于Oracle的应用程序 创建一个用户进程

用户进程和服务进程交流并在PGA中存储会话相关的信息

## 第二节课

-   Listener通常配置在服务端 通过TCP/IP进行传输
-   网络配置文件在客户端和服务端都要有



-   实验讲解:
    -   安装win7 64位虚拟机  安装好Oracle服务器
    -   内部自己测试
    -   外部安装客户端 连接自己Oracle服务端
    -   同学间连接Oracle服务器

-   物理结构:
    -   他是一个数据的集合 看作一个处理数据的单位
    -   主要由三种类型文件组成 (数据文件 控制文件 重做日志文件)
        -   控制文件:
            -   Oracle服务器在启动期间标识物理文件和数据库结构的二进制文件
            -   控制文件提供了建立新实例时所需要的文件目录
            -   用户建立控制文件,会创建多个同步副本 可以放到不同的物理驱动器上
            -   一个数据库只需要一个控制文件 但可以有多个副本
            -   包含数据库名,数据库唯一标志 二进制方式写入控制文件
            -   多以ctl后缀结尾 查看字典表v$controlfile
        -   数据文件:
            -   存放用户数据的地方
            -   每一个数据库至少有一个与之相关的数据文件 一般有很多个
            -   文件后缀多以dbf结尾
            -   查看DBA_DATA_FILES字典表
        -   重做日志文件:
            -   数据库的事务日志,记录对数据库的所有修改,用于恢复数据库
            -   数据库以两种模式运行: NOARCHIVELOG MODE(非归档) ARCHIVELOG MODE(归档)
            -   文件后缀以rdo或者log结尾
            -   查看字典表v$log和v$logfile
            -   Oracle的falshback(闪回)的能力很强
            -   每个实例至少有两个重做日志文件组 每一个重做日志文件组有一个单独的成员
            -   日志按照有序循环的方式被利用(一组填满循环覆盖下一组日志文件)
        -   参数文件:
            -   用于在启动实例时配置数据库
            -   初始化设置包括数据库实例名称<SID> 数据库主要文件的位置,实例使用的主要内存区域的大小等
            -   名称通常是: init<SID>.ora或spfile<SID>.ora
            -   配置好之后需要将init转化为spfile  create spfile from pfile..
            -   存储关系: 参数文件->控制文件->(数据文件 重做日志文件)
        -   归档文件:
            -   非活动的重做日志备份
-   逻辑结构
    -   Oracle可以装在多样系统上 可以没有操作系统运行
    -   表空间和数据文件: 一个表空间可以有多个数据文件 一个数据文件只能属于一个表空间
    -   表空间(类比盘符): 系统安装时表空间(多个)
    -   盘区
    -   数据块
-   关键级后台进程
    -   用来提高数据库的性能和可靠性 可以由多个用户同时使用
    -   系统监视器(System Monitor, SMOR) 重新启动系统,清除临时段,执行盘区结合等
        -   出现故障实例的情况下,SMON会负责重新启动系统,执行崩溃恢复,包括
            -   回滚未提交的事务处理
            -   处理实例崩溃未写入的数据文件的事务
            -   在数据库上应用重做日志表项(归档的重做日志文件)
        -   SMON会清除已经分配没有释放的临时段 在字典管理表控件中执行盘区结合
    -   进程监视器(Process Monitor,PMON) 监控服务器进程和注册数据库服务
        -   能够雄安会发生损坏或出现故障..
    -   数据库缓存
    -   日志写入器(LGWR) 以日志为准,日志比数据重要,数据没写可以根据日志写入数据(先期写入协议)
    -   检查点(checkpoint,CKPT)  负责使用最新的检查点信息更新所有的控制文件和数据文件标题
        -   保证所有修改过的数据库缓冲区数据都被写入磁盘数据库文件 (自动保存点,数据安全)
        -   在检查点完成后,系统将更新数据库头和控制文件以保证数据库所有文件同步
        -   关键参数: LOG_CHECKPOINT_TIMEOUT  LOG_CHECKPOOINT_INTERVAL
-   SQL语句执行过程
    -   COMMIT提交 ROLLBACK 回滚
    -   处理一个DML声明
        -   用户进程发送请求给PGA
        -   PGA查询数据字典 如果没有从数据文件中找 如果有从数据缓冲中找
        -   处理完成通知回写日志buffer 但是不写回文件
    -   commit过程
        -   先写日志 再写数据
        -   data buffer cache 中在两种条件下进行存储: 到缓存过一定量 或 到检查点
    -   SGA没有返回箭头

